<?xml version="1.0" encoding="UTF-8"?>
<job
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:proactive:jobdescriptor:3.14" xsi:schemaLocation="urn:proactive:jobdescriptor:3.14 http://www.activeeon.com/public_content/schemas/proactive/jobdescriptor/3.14/schedulerjob.xsd"  name="Init_Schedule" projectName="1. Initialization Options" tags="Schedule,Triggers" priority="normal" onTaskError="continueJobExecution"  maxNumberOfExecution="2"  >
    <variables>
        <variable name="START_NOW" value="True" model="PA:BOOLEAN" description="If true, the file listener will be activated immediately." group="Listener Schedule" advanced="false" hidden="false"/>
        <variable name="START_DATE" value="2024-04-01T00:00:00+01:00" model="PA:DATETIME(yyyy-MM-dd&#x27;T&#x27;HH:mm:ssXXX)?" description="Select a specific date to activate the file listener" group="Listener Schedule" advanced="false" hidden="true"/>
        <variable name="DAYS_TO_RUN" value="1" model="PA:INTEGER" description="Number of days the file listener is running." group="Listener Schedule" advanced="false" hidden="false"/>
        <variable name="HOURS_TO_RUN" value="10" model="PA:INTEGER" description="Number of hours the file listener is running." group="Listener Schedule" advanced="false" hidden="false"/>
        <variable name="MINUTES_TO_RUN" value="5" model="PA:INTEGER" description="Number of minutes the file listener is running." group="Listener Schedule" advanced="false" hidden="false"/>
        <variable name="END_DATE" value="2024-12-31T00:00:00+01:00" model="PA:DATETIME(yyyy-MM-dd&#x27;T&#x27;HH:mm:ssXXX)?" description="Select a specific date until which the file listener runs" group="Listener Schedule" advanced="false" hidden="true"/>
        <variable name="START_DATE_HANDLER" value="" model="PA:SPEL(variables[&#x27;START_NOW&#x27;].toLowerCase() == &#x27;false&#x27; ? showVar(&#x27;START_DATE&#x27;) : hideVar(&#x27;START_DATE&#x27;))" description="Handler which shows START_DATE in case START_NOW value is false" group="Listener Schedule" advanced="false" hidden="true"/>
        <variable name="END_DATE_HANDLER" value="" model="PA:SPEL(variables[&#x27;DAYS_TO_RUN&#x27;] == &#x27;0&#x27;  &amp;&amp; variables[&#x27;HOURS_TO_RUN&#x27;] == &#x27;0&#x27;  &amp;&amp; variables[&#x27;MINUTES_TO_RUN&#x27;] == &#x27;0&#x27;  ? showVar(&#x27;END_DATE&#x27;) &amp;&amp; hideVar(&#x27;DAYS_TO_RUN&#x27;) &amp;&amp; hideVar(&#x27;HOURS_TO_RUN&#x27;) &amp;&amp; hideVar(&#x27;MINUTES_TO_RUN&#x27;) : hideVar(&#x27;END_DATE&#x27;))" description="Handler which shows START_DATE based on DAYS and HOURS values" group="Listener Schedule" advanced="false" hidden="true"/>
    </variables>
    <description>
        <![CDATA[ Set the schedule options to start and end a file listener on a specific date and time, and seconds. ]]>
    </description>
    <genericInformation>
        <info name="bucketName" value="event-file-listener"/>
        <info name="workflow.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/file_listner_rule.png"/>
        <info name="START_AT" value="${START_DATE}"/>
        <info name="group" value="public-objects"/>
    </genericInformation>
    <taskFlow>
        <task name="Init_Schedule"




              fork="true">
            <description>
                <![CDATA[ Set the schedule options to start and end a file listener on a specific date and time, and seconds. ]]>
            </description>
            <genericInformation>
                <info name="task.icon" value="/automation-dashboard/styles/patterns/img/wf-icons/file_listner_rule.png"/>
            </genericInformation>
            <scriptExecutable>
                <script>
                    <code language="groovy">
                        <![CDATA[
import java.time.ZonedDateTime

startNow = variables.get("START_NOW").toBoolean()
startDate = ZonedDateTime.now()
if(!startNow){
    startDate = ZonedDateTime.parse(variables.get("START_DATE"))
}
daysToRun = Integer.parseInt(variables.get("DAYS_TO_RUN"))
hoursToRun = Integer.parseInt(variables.get("HOURS_TO_RUN"))
minutesToRun = Integer.parseInt(variables.get("MINUTES_TO_RUN"))
endDate = startDate.plusDays(daysToRun).plusHours(hoursToRun).plusMinutes(minutesToRun)
if(daysToRun == 0 && hoursToRun == 0 && minutesToRun == 0){
    endDate = variables.get("END_DATE")
}
println("The file listener is scheduled to listen to files on a defined location from the start date " + startDate.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME) + " until the end date "  + endDate.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME))

variables.put("START_DATE", startDate.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME))
variables.put("END_DATE", endDate.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME))
]]>
                    </code>
                </script>
            </scriptExecutable>
            <metadata>
                <positionTop>
                    102.607421875
                </positionTop>
                <positionLeft>
                    406.2890625
                </positionLeft>
            </metadata>
        </task>
    </taskFlow>
    <metadata>
        <visualization>
            <![CDATA[ <html>
    <head>
    <link rel="stylesheet" href="/studio/styles/studio-standalone.css">
        <style>
        #workflow-designer {
            left:0 !important;
            top:0 !important;
            width:2673px;
            height:3350px;
            }
        </style>
    </head>
    <body>
    <div id="workflow-visualization-view"><div id="workflow-visualization" style="position:relative;top:-97.607421875px;left:-401.2890625px"><div class="task _jsPlumb_endpoint_anchor_ ui-draggable" id="jsPlumb_1_862" style="top: 102.608px; left: 406.289px;"><a class="task-name" data-toggle="tooltip" data-placement="right" title="" data-original-title="Set the schedule options to start and end a file listener on a specific date and time, and seconds."><img src="/automation-dashboard/styles/patterns/img/wf-icons/file_listner_rule.png" width="20px">&nbsp;<span class="name">Init_Schedule</span></a>&nbsp;&nbsp;<a id="called-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: 17px; right: 3px;"><i title="Workflows being Called by this Task" id="called-icon"></i></a><a title="Scripts being Called by this Task" id="reference-icon-a" href="javascript:void(0)" class="pointer" style=" position: inherit; top: -7px; right: 3px;"><i id="reference-icon"></i></a></div><div class="_jsPlumb_endpoint source-endpoint dependency-source-endpoint connected _jsPlumb_endpoint_anchor_ ui-draggable ui-droppable" style="position: absolute; height: 20px; width: 20px; left: 446px; top: 133px;"><svg style="position:absolute;left:0px;top:0px" width="20" height="20" pointer-events="all" position="absolute" version="1.1" xmlns="http://www.w3.org/1999/xhtml"><circle cx="10" cy="10" r="10" version="1.1" xmlns="http://www.w3.org/1999/xhtml" fill="#666" stroke="none" style=""></circle></svg></div></div></div>
    </body>
</html>
 ]]>
        </visualization>
    </metadata>
</job>